(function () {
	'use strict';

	frappe.templates['pos_custom'] = '<div class="pos">  <div class="row">   <div class="col-sm-6 pos-bill-wrapper">    <div class="col-sm-12"><h6 class="form-section-heading uppercase"><span class="firstspan">{{ __("Item Cart") }}</span> <span  class="secondspan">ShortCut Key: Select Item in cart and press del, ctrl+Enter key to Pay, shift+Enter to Print Receipt, shift+N to For New Cart</span></h6></div>    <div class="pos-bill">     <div class="item-cart">      <div class="pos-list-row pos-bill-header text-muted h6">       <span class="cell subject">                {{ __("Item Name")}}       </span>       <span class="cell text-right">{{ __("Quantity") }}</span>       <span class="cell text-right">{{ __("Discount") }}</span>       <span class="cell text-right">{{ __("Rate") }}</span>      </div>      <div class="item-cart-items">       <div class="no-items-message text-extra-muted">        <span class="text-center">         <i class="fa fa-2x fa-shopping-cart"></i>         <p>{{ __("Tap items to add them here") }}</p>        </span>       </div>       <div class="items">       </div>      </div>     </div>    </div>    <div class="totals-area">     <div class="pos-list-row net-total-area">      <div class="cell"></div>      <div class="cell text-right">{%= __("Net Total") %}</div>      <div class="cell price-cell bold net-total text-right"></div>     </div>     <div class="pos-list-row tax-area">      <div class="cell"></div>      <div class="cell text-right">{%= __("Taxes") %}</div>      <div class="cell price-cell text-right tax-table">      </div>     </div>     {% if(allow_user_to_edit_discount) { %}      <div class="pos-list-row discount-amount-area">       <div class="cell"></div>       <div class="cell text-right">{%= __("Discount") %}</div>       <div class="cell price-cell discount-field-col">        <div class="input-group input-group-sm">         <span class="input-group-addon">%</span>         <input type="text" class="form-control discount-percentage text-right">        </div>        <div class="input-group input-group-sm">         <span class="input-group-addon">{%= get_currency_symbol(currency) %}</span>         <input type="text" class="form-control discount-amount text-right" placeholder="{%= 0.00 %}">        </div>       </div>      </div>     {% } %}     <div class="pos-list-row grand-total-area collapse-btn" style="border-bottom:1px solid #d1d8dd;">      <div class="cell">       <a class="">        <i class="octicon octicon-chevron-down"></i>       </a>      </div>      <div class="cell text-right bold">{%= __("Grand Total") %}</div>      <div class="cell price-cell grand-total text-right lead"></div>     </div>     <div class="pos-list-row qty-total-area collapse-btn" style="border-bottom:1px solid #d1d8dd;">      <div class="cell">       <a class="">        <i class="octicon octicon-chevron-down"></i>       </a>      </div>      <div class="cell text-right bold">{%= __("Qty Total") %}</div>      <div class="cell price-cell qty-total text-right lead"></div>     </div>    </div>    <div class="row" style="margin-top: 30px">     <div class="col-sm-6 selected-item">      </div>     <div class="col-xs-6 numeric_keypad hidden-xs" style="display:none">      {% var chartData = ["Qty", "Disc", "Price"] %} {% for(var i=0; i      <3; i++) { %} <div class="row text-right">       {% for(var j=i*3; j       <(i+1)*3; j++) { %} <button type="button" class="btn btn-default numeric-keypad" val="{{j+1}}">{{j+1}}</button>        {% } %}        <button type="button" {% if((!allow_user_to_edit_rate && __(chartData[i]) == __("Price")) || (!allow_user_to_edit_discount && __(chartData[i]) == __("Disc"))) { %} disabled {% } %} id="pos-item-{{ chartData[i].toLowerCase() }}" class="btn text-center btn-default numeric-keypad pos-operation">{{ __(chartData[i]) }}</button>     </div>     {% } %}     <div class="row text-right">      <button type="button" class="btn btn-default numeric-keypad numeric-del">{{ __("Del") }}</button>      <button type="button" class="btn btn-default numeric-keypad" val="0">0</button>      <button type="button" class="btn btn-default numeric-keypad" val=".">.</button>      <button type="button" class="btn btn-primary numeric-keypad pos-pay">{{ __("Pay") }}</button>     </div>    </div>   </div>  </div>  <div class="col-sm-6 list-customers">   <div class="col-sm-12"><h6 class="form-section-heading uppercase">{{ __("Customers in Queue") }}</h6></div>   <div class="pos-list-row pos-bill-header">    <div class="cell subject"><input class="list-select-all" type="checkbox">{{ __("Customer") }}</div>    <div class="cell text-left">{{ __("Status") }}</div>    <div class="cell text-right">{{ __("Amount") }}</div>    <div class="cell text-right">{{ __("Grand Total") }}</div>   </div>   <div class="list-customers-table border-left border-right border-bottom">    <div class="no-items-message text-extra-muted">     <span class="text-center">      <i class="fa fa-2x fa-user"></i>      <p>{{ __("No Customers yet!") }}</p>     </span>    </div>   </div>  </div>  <div class="col-sm-6 pos-items-section">   <div class="col-sm-12"><h6 class="form-section-heading uppercase">{{ __("Stock Items") }}</h6></div>   <div class="row pos-item-area">    </div>   <span id="customer-results" style="color:#68a;"></span>   <div class="item-list-area">    <div class="pos-list-row pos-bill-header text-muted h6">     <div class="cell subject search-item-group">      <div class="dropdown">       <a class="text-muted dropdown-toggle" data-toggle="dropdown"><span class="dropdown-text">{{ __("All Item Groups") }}</span><i class="caret"></i></a>       <ul class="dropdown-menu">       </ul>      </div>     </div>     <div class="cell search-item"></div>    </div>    <div class="row item-list-titles" style="margin-left:0px;margin-right:0px;">      <div class="col-sm-5" style="text-align:center;">       Product Name      </div>      <div class="col-sm-3" style="text-align:center;">       Price      </div>      <div class="col-sm-2" style="text-align:center;">       QTY      </div>            <div class="col-sm-2" style="text-align:center;">       Shelf      </div>    </div>    <div class="app-listing item-list image-view-container">     </div>    </div>  </div> </div> ';

	frappe.templates['pos_bill_item'] = '<div class="row pos-bill-row pos-bill-item" data-item-code="{%= item_code %}">     <div class="col-xs-4"><h6>{%= item_code || "" %}{%= __(item_name) || "" %}</h6></div>     <div class="col-xs-3">         <div class="row pos-qty-row">             <div class="col-xs-2 text-center pos-qty-btn" data-action="decrease-qty"><i class="fa fa-minus text-muted" style="font-size:12px"></i></div>             <div class="col-xs-8">     <div>                     <input type="tel" value="{%= qty %}" class="form-control   pos-item-qty text-right">                 </div>                 {% if(actual_qty != null) { %}                 <div style="margin-top: 5px;" class="text-muted small text-right">                     {%= __("In Stock: ") %} <span>{%= actual_qty || 0.0 %}</span>                 </div>                 {% } %}             </div>             <div class="col-xs-2 text-center pos-qty-btn" data-action="increase-qty"><i class="fa fa-plus text-muted" style="font-size:12px"></i></div>         </div>     </div>     <div class="col-xs-2 text-right">   <div class="row input-sm">             <input type="tel" value="{%= discount_percentage %}" class="form-control text-right pos-item-disc">         </div>     </div>     <div class="col-xs-3 text-right">         <div class="text-muted" style="margin-top: 5px;">    {% if(enabled) { %}     <input type="tel" value="{%= rate %}" class="form-control input-sm pos-item-price text-right">    {% } else { %}     <h6>{%= format_currency(rate) %}</h6>    {% } %}   </div>   <p><h6>{%= amount %}</h6></p>     </div> </div> ';

	frappe.templates['pos_bill_item_new'] = '<div class="pos-list-row pos-bill-item {{ selected_class }}" data-item-code="{{ item_code }}">  <div class="cell subject">      <a class="grey list-id" title="{{ item_name }}">{{ strip_html(__(item_name)) || item_code }}</a>  </div>  <div class="cell text-right">{%= qty %}</div>  <div class="cell text-right">{%= discount_percentage %}</div>  <div class="cell text-right">{%= format_currency(rate) %}</div> </div> ';

	frappe.templates['pos_selected_item'] = '<div class="pos-selected-item-action" data-item-code="{%= item_code %}" data-idx="{%= idx %}">  <div class="pos-list-row">   <div class="cell">{{ __("Quantity") }}:</div>   <input type="tel" class="form-control cell pos-item-qty" value="{%= qty %}"/>  </div>  <div class="pos-list-row">   <div class="cell">{{ __("Price List Rate") }}:</div>   <input type="tel" class="form-control cell" disabled value="{%= price_list_rate %}"/>  </div>  <div class="pos-list-row">   <div class="cell">{{ __("Discount") }}: %</div>   <input type="tel" class="form-control cell pos-item-disc" {% if !allow_user_to_edit_discount %} disabled {% endif %} value="{%= discount_percentage %}">  </div>  <div class="pos-list-row">   <div class="cell">{{ __("Price") }}:</div>   <input type="tel" class="form-control cell pos-item-price" {% if !allow_user_to_edit_rate %} disabled {% endif %} value="{%= rate %}"/>  </div>   <div class="pos-list-row">   <div class="cell">{{ __("Amount") }}:</div>   <input type="tel" class="form-control cell pos-amount" disabled value="{%= amount %}"/>  </div> </div>';

	frappe.templates['pos_custom_item'] = '<div class="pos-item-wrapper image-view-item" data-item-code="{{item_code}}" data-total-qty="{{ __(item_stock) }}">   <div class="image-view-header doclist-row">    <div class="list-value">     <a class="grey list-id" style="color:#f1ff42" data-name="{{item_code}}" title="{{ item_name || item_code}}">      <div class="row item-list-rows" style="margin-left:0px;margin-right:0px;">       <div class="col-sm-5">{{item_brand_name}} {{item_name || item_code}} {{item_type}}  {{item_volume}} </div>       <div class="col-sm-3" style="text-align:center;">{{item_price}} / pcs</div>       <div class="col-sm-2">{{ __(item_stock) }}</div>              <div class="col-sm-2">{{item_shelf}}</div>       </div>     </a>    </div>   </div>   </div>';

	frappe.templates['pos_tax_row'] = '<div class="pos-list-row" style="padding-right: 0;">  <div class="cell">{%= description %}</div>  <div class="cell text-right bold">{%= tax_amount %}</div> </div> ';

	frappe.templates['customer_toolbar'] = '<div class="pos-bill-toolbar col-xs-9" style="display: flex; width: 70%;">  <div class="party-area" style="flex: 1;">   <span class="edit-customer-btn text-muted" style="display: inline;">    <a class="btn-open no-decoration" title="Edit Customer">     <i class="octicon octicon-pencil"></i>    </a>    </span>  </div>  <button class="btn btn-default list-customers-btn" style="margin-left: 12px">   <i class="octicon octicon-organization"></i>  </button>  </button> {% if (allow_delete) { %}  <button class="btn btn-default btn-danger" style="margin: 0 5px 0 5px">    <i class="octicon octicon-trashcan"></i>   </button> {% } %} </div>';

	frappe.templates['pos_invoice_list'] = '<div class="pos-list-row" invoice-name = "{{name}}">  <div class="list-column cell subject" invoice-name = "{{name}}">   <input class="list-delete text-left" type="checkbox" style = "margin-right:5px">   <a class="grey list-id text-left customer-row" title="{{ customer }}">{%= customer %}</a>  </div>  <div class="list-column cell text-left customer-row"><span class="indicator {{data.indicator}}">{{ data.status }}</span></div>  <div class="list-column cell text-right customer-row">{%= paid_amount %}</div>  <div class="list-column cell text-right customer-row">{%= grand_total %}</div> </div> ';

	frappe.templates['qty_custom'] = '<div class="pos-selected-item-action modaqty" data-item-code="{%= item_code %}" data-idx="1">   <div class="pos-list-row">     <input type="tel"  class="form-control cell inputmodalqty inputqty-{%= item_code %}"  onblur="this.focus();this.select();" value="1" autofocus="autofocus" />   </div>   </div>';

	// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors
	// License: GNU General Public License v3. See license.txt

	erpnext.payments = erpnext.stock.StockController.extend({
		make_payment: function() {

			this.dialog = new frappe.ui.Dialog({
				title: 'Payment'
			});
		
			this.dialog.show();
			this.dialog.$wrapper.find('.modal-dialog').find("button.btn.btn-primary.btn-sm").attr("id","btn-payout-enter");
			this.$body = this.dialog.body;
			this.dialog.$wrapper.find('.modal-dialog').find(".amount").focus();
			this.dialog.$wrapper.find('.modal-dialog').find(".amount").select();
			this.set_payment_primary_action();
			this.make_keyboard();
			this.select_text();
		},

		select_text: function(){
			$(this.$body).find('.form-control').click(function(){
				$(this).select();
			});
		},

		set_payment_primary_action: function(){
			var me = this;
		
			this.dialog.set_primary_action(__("Submit"), function() {
				// Allow no ZERO payment
				$.each(me.frm.doc.payments, function (index, data) {
					if (data.amount != 0) {
						me.dialog.hide();
						me.submit_invoice();
						return;
					}
				});
				$('.modal-dialog').find("button.btn.btn-primary.btn-sm").removeAttr("id");
			});
		},

		make_keyboard: function(){
			$(this.$body).empty();
			$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc));
			this.show_payment_details();
			this.bind_keyboard_event();
			this.clear_amount();
		},

		make_multimode_payment: function(){
			var me = this;

			if(this.frm.doc.change_amount > 0){
				me.payment_val = me.doc.outstanding_amount;
			}

			this.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', "payments");
			this.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();
			this.payments.amount = flt(this.payment_val);
		},

		show_payment_details: function(){
			var me = this;
			var multimode_payments = $(this.$body).find('.multimode-payments').empty();
			if(this.frm.doc.payments.length){
				$.each(this.frm.doc.payments, function(index, data){
					$(frappe.render_template('payment_details', {
						mode_of_payment: data.mode_of_payment,
						amount: data.amount,
						idx: data.idx,
						currency: me.frm.doc.currency,
						type: data.type
					})).appendTo(multimode_payments);

					if (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {
						me.idx = data.idx;
						me.selected_mode = $(me.$body).find(repl("input[idx='%(idx)s']",{'idx': me.idx}));
						me.highlight_selected_row();
						me.bind_amount_change_event();
					}
				});
			}else{
				$("<p>No payment mode selected in pos profile</p>").appendTo(multimode_payments);
			}
		},

		set_outstanding_amount: function(){
			this.selected_mode = $(this.$body).find(repl("input[idx='%(idx)s']",{'idx': this.idx}));
			this.highlight_selected_row();
			this.payment_val = 0.0;
			if(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){
				//When user first time click on row
				this.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision("outstanding_amount"));
				this.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));
				this.update_payment_amount();
			}else if(flt(this.selected_mode.val()) > 0){
				//If user click on existing row which has value
				this.payment_val = flt(this.selected_mode.val());
			}
			this.selected_mode.select();
			this.bind_amount_change_event();
		},
		
		bind_keyboard_event: function(){
			this.payment_val = '';
			this.bind_form_control_event();
			this.bind_numeric_keys_event();
			$(this.$body).find('.pos-payment-row').find('.amount').keyup(function (e) {
				if (e.keyCode == 13) {
				   console.log("DAS");
				   $('.modal-dialog').find("#btn-payout-enter").click(); 
			    } 
			});
		},

		bind_form_control_event: function(){
			var me = this;
			$(this.$body).find('.pos-payment-row').click(function(){
				me.idx = $(this).attr("idx");
				me.set_outstanding_amount();
			});
			
			$(this.$body).find('.form-control').click(function(){
				me.idx = $(this).attr("idx");
				me.set_outstanding_amount();
				me.update_paid_amount(true);
			});
			
			$(this.$body).find('.write_off_amount').change(function(){
				me.write_off_amount(flt($(this).val()), precision("write_off_amount"));
			});
			
			$(this.$body).find('.change_amount').change(function(){
				me.change_amount(flt($(this).val()), precision("change_amount"));
			});
		},

		highlight_selected_row: function(){
			var selected_row = $(this.$body).find(repl(".pos-payment-row[idx='%(idx)s']",{'idx': this.idx}));
			$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode');
			selected_row.addClass('selected-payment-mode');
			$(this.$body).find('.amount').attr('disabled', true);
			this.selected_mode.attr('disabled', false);
		},
		
		bind_numeric_keys_event: function(){
			var me = this;
			$(this.$body).find('.pos-keyboard-key').click(function(){
				me.payment_val += $(this).text();
				me.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));
				me.idx = me.selected_mode.attr("idx");
				me.update_paid_amount();
			});
			
			$(this.$body).find('.delete-btn').click(function(){
				me.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);
				me.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));
				me.idx = me.selected_mode.attr("idx");
				me.update_paid_amount();
			});

		},
		
		bind_amount_change_event: function(){
			var me = this;
			this.selected_mode.change(function(){
				me.payment_val =  flt($(this).val()) || 0.0;
				me.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));
				me.idx = me.selected_mode.attr("idx");
				me.update_payment_amount();
			});
		},

		clear_amount: function() {
			var me = this;
			$(this.$body).find('.clr').click(function(e){
				e.stopPropagation();
				me.idx = $(this).attr("idx");
				me.selected_mode = $(me.$body).find(repl("input[idx='%(idx)s']",{'idx': me.idx}));
				me.payment_val = 0.0;
				me.selected_mode.val(0.0);
				me.highlight_selected_row();
				me.update_payment_amount();
			});
		},

		write_off_amount: function(write_off_amount) {

			this.frm.doc.write_off_amount = flt(write_off_amount, precision("write_off_amount"));
			this.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,
				precision("base_write_off_amount"));
			this.calculate_outstanding_amount(false);
			this.show_amounts();
		},

		change_amount: function(change_amount) {

			this.frm.doc.change_amount = flt(change_amount, precision("change_amount"));
			this.calculate_write_off_amount();
			this.show_amounts();
		},

		update_paid_amount: function(update_write_off) {
			var me = this;
			if(in_list(['change_amount', 'write_off_amount'], this.idx)){
				var value = me.selected_mode.val();
				if(me.idx == 'change_amount'){
					me.change_amount(value);
				} else{
					if(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {
						value = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));
					}
					me.write_off_amount(value);
				}
			}else{
				this.update_payment_amount();
			}
		},

		update_payment_amount: function(){
			var me = this;

			$.each(this.frm.doc.payments, function(index, data){
				if(cint(me.idx) == cint(data.idx)){
					data.amount = flt(me.selected_mode.val(), 2);
				}
			});

			this.calculate_outstanding_amount(false);
			this.show_amounts();
		},

		show_amounts: function(){
			$(this.$body).find(".write_off_amount").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));
			$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));
			$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));
			$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(":Company", this.frm.doc.company).default_currency));
			this.update_invoice();
		}
	});

	frappe.templates['pos_payment_custom'] = '<div class="pos_payment row">  <div class="row" style="padding: 0px 30px;">   <h3>{{ __("Total Amount") }}: <span class="label label-default" style="font-size:20px;padding:5px">{%= format_currency(grand_total, currency) %}</span></h3>  </div>  <div class="row amount-row">   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Paid") }} <h3 class="paid_amount">{%= format_currency(paid_amount, currency) %}</h3></p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Outstanding") }} <h3 class="outstanding_amount">{%= format_currency(outstanding_amount, currency) %} </h3></p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Change") }} <input class="form-control text-right change_amount bold" type="text" idx="change_amount" value="{{format_number(change_amount, null, 2)}}">    </p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Write off") }} <input class="form-control text-right write_off_amount bold" type="text" idx="write_off_amount" value="{{format_number(write_off_amount, null, 2)}}">    </p>   </div>  </div>  <hr>  <div class="row">   <div class="col-sm-6 ">    <div class ="row multimode-payments" style = "margin-right:10px">    </div>   </div>   <div class="col-sm-6 payment-toolbar">    {% for(var i=0; i<3; i++) { %}     <div class="row">      {% for(var j=i*3; j<(i+1)*3; j++) { %}       <button type="button"  class="btn btn-default pos-keyboard-key">{{j+1}}</button>      {% } %}     </div>    {% } %}    <div class="row">     <button type="button"  class="btn btn-default delete-btn">{{ __("Del") }}</button>     <button type="button"  class="btn btn-default pos-keyboard-key">0</button>     <button type="button"  class="btn btn-default pos-keyboard-key">.</button>    </div>         </div>  </div> </div> ';

	frappe.templates['payment_details_custom'] = '<div class="row pos-payment-row" type="{{type}}" idx={{idx}}>     <div class="col-xs-6" style="padding:20px">{{mode_of_payment}}</div>  <div class="col-xs-6">   <div class="input-group">    <input disabled class="form-control text-right amount" idx="{{idx}}" type="text" value="{%= format_currency(amount, currency) %}" autofocus="autofocus">    <span class="input-group-btn">     <button type="button" class="btn btn-default clr" idx="{{idx}}" style="border:1px solid #d1d8dd">C</button>    </span>   </div>  </div> </div>';

}());
//# sourceMappingURL=custom.pos.erpnext.min.js.map
